(window.webpackJsonp=window.webpackJsonp||[]).push([[249],{iS7P:function(e,t,i){"use strict";i.r(t);var a=i("fbSu"),n=i.n(a),l=i("5T12"),r=i.n(l),o=i("qHWA"),d=i.n(o),s=i("rx6U"),c=i.n(s),f=i("4tJN"),m=i.n(f),p=i("Qsbb"),u=i.n(p),g=(i("9U97"),i("kO4A"),i("+kFb"),i("Z5ek"),i("8Qi2"),i("MoW5"),i("IdsT"),i("l9AF"),i("Id6h"),i("3fBH"),i("g2mn")),h=i("UpC8"),b=(i("fx2i"),i("cZi0")),y=i("YqOB"),I=(i("TSXX"),i("iZJp")),k=i("Id3l"),v=i("RNsw"),F=i("OR/T"),w=i("bn5B"),x=i("PnTt"),T=i("r0ML"),C=i.n(T),R=i("U8v4"),j=i("l02b"),z=i.n(j),D=i("vcLm");function S(e,t){var i=u()(e);if(m.a){var a=m()(e);t&&(a=a.filter(function(t){return c()(e,t).enumerable})),i.push.apply(i,a)}return i}function E(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach(function(t){Object(y.a)(e,t,i[t])}):d.a?r()(e,d()(i)):S(Object(i)).forEach(function(t){n()(e,t,c()(i,t))})}return e}var L=function(e){function t(e){var i;return Object(k.a)(this,t),(i=Object(F.a)(this,Object(w.a)(t).call(this,e))).state={riskId:e.match.params.riskId||"",releaseId:e.match.params.releaseId||"",loadingSend:!1,actionBtnsVal:[],projectId:e.match.params.projectId,projectName:e.match.params.projectName},i}return Object(x.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,i=t.routerInfo.routeData[t.routerInfo.curKey];t.myFetch("getSysMenuBtn",{menuParentId:i._value,tableField:"projectInfo"}).then(function(t){var i=t.success,a=t.data;t.message;i&&e.setState({actionBtnsVal:a})})}},{key:"render",value:function(){var e=this,t=this.state,i=t.riskId,a=t.actionBtnsVal,n=t.releaseId,l=t.projectId,r=t.projectName,o=this.props.myPublic,d=o.domain,s=o.appInfo.ureport;return C.a.createElement("div",{className:z.a.root},C.a.createElement(g.a,{spinning:this.state.loadingSend},C.a.createElement(D.a,Object(h.a)({},this.props,{fetchConfig:{apiName:"getZjTzRiskDetailList",otherParams:{riskId:i,projectId:l}},fetch:this.props.myFetch,wrappedComponentRef:function(t){e.formmm=t},upload:this.props.myUpload,headers:{token:this.props.loginAndLogoutInfo.loginInfo.token},formConfig:[{label:"\u4e3b\u952eid",field:"codePid",hide:!0},{label:"\u5916\u5c42\u4e3b\u952eid",field:"riskId",hide:!0},{type:"qnnTable",field:"zjTzRiskDetailList",incToForm:!0,qnnTableConfig:{wrappedComponentRef:function(t){return e.myQnnTable=t},actionBtnsPosition:"top",antd:{rowKey:"riskDetailId",size:"small",scroll:{y:.65*document.documentElement.clientHeight}},rowDisabledCondition:function(e,t){return"main"===e.mainFlag},drawerConfig:{width:"1000px"},limit:999,curPage:1,paginationConfig:!1,firstRowIsSearch:!1,isShowRowSelect:!0,formConfig:[{isInTable:!1,form:{field:"riskDetailId",type:"string",hide:!0}},{isInTable:!1,form:{field:"colourFlag",type:"string",hide:!0}},{isInTable:!1,form:{field:"mainFlag",type:"string",hide:!0}},{isInTable:!1,form:{field:"riskId",type:"string",initialValue:i,hide:!0}},{isInTable:!1,form:{label:"\u6240\u5c5e\u98ce\u9669\u7c7b\u522b",type:"select",addDisabled:!0,initialValue:"8",field:"typeId",editDisabled:!0,optionConfig:{label:"itemName",value:"itemId"},fetchConfig:{apiName:"getBaseCodeSelect",otherParams:{itemId:"suoSuFengXianLeiBie"}},required:!0}},{table:{title:"\u98ce\u9669\u6e05\u5355\u540d\u79f0",dataIndex:"number",width:200,fixed:"left",tdEdit:!0,key:"number",render:function(e,t){return C.a.createElement(I.a,{title:e},C.a.createElement("div",{style:{color:t.colourFlag}},e))},fieldsConfig:{type:"string",field:"riskName",disabled:function(e){var t=e.record;return"1"===n||"1"!=t.addFlag},style:function(t,i){for(var a="",n=e.formmm.form.getFieldsValue().zjTzRiskDetailList,l=0;l<n.length;l++)for(var r=0;r<n[l].children.length;r++)n[l].children[r].riskName===t&&(a=n[l].children[r].colourFlag);return{color:a}}}},form:{type:"string",field:"riskName",placeholder:"\u8bf7\u8f93\u5165",required:!0}},{table:{title:"\u7ba1\u7406\u5c42\u7ea7",tdEdit:!0,width:100,tooltip:23,dataIndex:"managLever",key:"managLever",fieldsConfig:{type:"textarea",field:"managLever",autoSize:{minRow:1},disabled:function(e){var t=e.record;return"1"===n||"1"!=t.addFlag}}},form:{label:"\u7ba1\u7406\u5c42\u7ea7",type:"textarea",field:"managLever",placeholder:"\u8bf7\u8f93\u5165"}},{table:{title:"\u9002\u7528\u9879\u76ee\u7c7b\u578b",width:130,tooltip:23,tdEdit:!0,dataIndex:"applicableItemType",key:"applicableItemType",fieldsConfig:{autoSize:{minRow:1},type:"textarea",field:"applicableItemType",disabled:function(e){var t=e.record;return"1"===n||"1"!=t.addFlag}}},form:{label:"\u9002\u7528\u9879\u76ee\u7c7b\u578b",type:"textarea",field:"applicableItemType",placeholder:"\u8bf7\u8f93\u5165"}},{isInTable:!1,form:{label:"\u5907\u6ce8",type:"textarea",field:"remarks",placeholder:"\u8bf7\u8f93\u5165"}},{table:{title:"\u98ce\u9669\u662f\u5426\u5b58\u5728",tdEdit:!0,width:120,dataIndex:"existRiskFlag",type:"select",fieldsConfig:{type:"select",field:"existRiskFlag",optionData:[{label:"\u5426",value:"0"},{label:"\u662f",value:"1"}],disabled:function(){return"1"===n}},key:"existRiskFlag"},form:{type:"select",field:"existRiskFlag",optionData:[{label:"\u5426",value:"0"},{label:"\u662f",value:"1"}]}},{table:{title:"\u5177\u4f53\u5185\u5bb9\u63cf\u8ff0",width:180,tooltip:23,dataIndex:"specificDesc",tdEdit:!0,key:"specificDesc",fieldsConfig:{type:"textarea",autoSize:{minRow:1,maxRow:4},field:"specificDesc",disabled:function(e){var t=e.record;return"1"===n||"0"===t.existRiskFlag}}},isInForm:!1},{table:{title:"\u89e3\u51b3\u63aa\u65bd",dataIndex:"solution",tdEdit:!0,width:140,tooltip:23,fieldsConfig:{field:"solution",type:"textarea",autoSize:{minRows:1,maxRows:4},disabled:function(e){var t=e.record;return"1"===n||"0"===t.existRiskFlag}},key:"solution"},isInForm:!1},{table:{title:"\u9884\u8ba1\u89e3\u9664\u65f6\u95f4",dataIndex:"planTime",key:"planTime",tdEdit:!0,width:140,format:"YYYY-MM-DD",fieldsConfig:{field:"planTime",type:"date",disabled:function(e){var t=e.record;return"1"===n||"0"===t.existRiskFlag}}},isInForm:!1},{table:{title:"\u5b9e\u9645\u89e3\u9664\u65f6\u95f4",dataIndex:"actualTime",tdEdit:!0,width:140,format:"YYYY-MM-DD",fieldsConfig:{field:"actualTime",type:"date",disabled:function(e){var t=e.record;return"0"===n||"0"===t.existRiskFlag}},key:"actualTime"},isInForm:!1},{table:{title:"\u672a\u5b8c\u6210\u539f\u56e0\u5206\u6790",dataIndex:"uncompletedAnalysis",tdEdit:!0,width:180,tooltip:23,fieldsConfig:{type:"string",field:"uncompletedAnalysis",disabled:function(e){var t=e.record;return"0"===n||"0"===t.existRiskFlag}},key:"uncompletedAnalysis"},isInForm:!1},{table:{title:"\u8d23\u4efb\u4eba",width:180,tooltip:23,dataIndex:"personInCharge",tdEdit:!0,key:"personInCharge",fieldsConfig:{type:"string",field:"personInCharge",disabled:function(e){var t=e.record;return"1"===n||"0"===t.existRiskFlag}}},isInForm:!1},{table:{title:"\u6210\u679c\u5206\u6790",width:180,tooltip:23,dataIndex:"resultAnalysis",tdEdit:!0,key:"resultAnalysis",fieldsConfig:{type:"string",field:"resultAnalysis",disabled:function(e){var t=e.record;return"0"===n||"0"!==t.existRiskFlag&&!t.actualTime}}},isInForm:!1},{table:{title:"\u9644\u4ef6",width:520,dataIndex:"zjTzFileList",key:"zjTzFileList",tdEdit:!0,fieldsConfig:{field:"zjTzFileList",type:"files",max:1,fetchConfig:{apiName:window.configs.domain+"upload"},showDownloadIcon:!0,onPreview:"bind:_docFilesByOfficeUrl",disabled:function(e){e.record;return"1"===n}},render:function(e,t){return e&&t.zjTzFileList.length>0?C.a.createElement("div",{onClick:function(){}},C.a.createElement("a",{target:"_blank",href:t.zjTzFileList[0].url},t.zjTzFileList[0].name)):""}},form:{field:"zjTzFileList",type:"files",max:1,fetchConfig:{apiName:window.configs.domain+"upload",otherParams:{name:"\u98ce\u9669\u7ba1\u7406"}},showDownloadIcon:!0,onPreview:"bind:_docFilesByOfficeUrl"}}],method:{save:function(t){var i=e.formmm.form.getFieldsValue();t.btnCallbackFn.setBtnsLoading("add","diySave"),e.setState({loadingSend:!0}),e.props.myFetch("saveZjTzRiskAllDetail",i).then(function(i){var a=i.success,n=i.code,l=i.message;t.btnCallbackFn.setBtnsLoading("remove","diySave"),a?(e.setState({loadingSend:!1}),t.btnCallbackFn.successMsg(l),e.formmm.refresh()):t.btnCallbackFn.errMsg(l,n)})},goBack:function(t){var i=e.props.myPublic.appInfo.mainModule;e.props.dispatch(Object(R.push)("".concat(i,"RiskMange")))},addOtherRisk:function(t){var i={addFlag:"1",riskDetailId:Math.random().toFixed("3")},a=t.state.data.map(function(e){var t=e.children||[];return"8"===e.typeId?E({},e,{children:t.concat([E({},i,{typeId:e.typeId,typeName:e.typeName})])}):e});e.myQnnTable.qnnSetState({expandedRowKeys:t.state.data.filter(function(e){return"8"===e.typeId}).map(function(e){return e.riskDetailId})},function(){e.formmm.setValues({zjTzRiskDetailList:a})})},delClick:function(t){var i=t.btnCallbackFn,a=t.selectedRows,n=t.state.data,l=void 0===n?[]:n,r=[],o={},d=[],s=e.formmm.form.getFieldsValue().zjTzRiskDetailList;if(a.length>0){for(var c=0;c<a.length;c++)"main"===a[c].mainFlag&&r.push(a[c].mainFlag);if(r.length>0)i.closeDrawer(),b.b.warn("\u5916\u5c42\u6570\u636e\u4e0d\u80fd\u5220\u9664!"),i.clearSelectedRows();else{if(a.length>0&&a.forEach(function(e,t){e&&(o[e.riskDetailId]=!0)}),l.length>0)for(var f=0;f<l.length;f++)for(var m=0;m<l[f].children.length;m++)o[l[f].children[m].riskDetailId]||d.push(l[f].children[m]);for(var p=0;p<s.length;p++){s[p].children=[];for(var u=0;u<d.length;u++)s[p].typeName===d[u].typeName&&s[p].children.push(d[u])}i.clearSelectedRows(),i.setState({data:s},function(){i.refresh()})}}else b.b.warn("\u8bf7\u9009\u62e9\u6570\u636e!")},hideClick:function(){return"1"===n},exportClick:function(e){window.open(s+"excel?_u=file:zjTzRiskDetail.xml&_n="+r+"\u98ce\u9669\u5206\u6790&url="+d+"&riskId="+i)}},actionBtns:a}}],btns:[]}))))}}]),t}(T.Component);t.default=L}}]);