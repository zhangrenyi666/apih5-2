(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{f1LU:function(e,a,t){"use strict";t.r(a);t("kO4A"),t("FMw2"),t("Z5ek"),t("jnfO"),t("8Qi2"),t("IdsT"),t("QifN"),t("l9AF"),t("3fBH");var n=t("g2mn"),i=t("UpC8"),l=(t("8xN/"),t("QvOI")),o=(t("fx2i"),t("cZi0")),c=t("Id3l"),r=t("RNsw"),d=t("OR/T"),s=t("bn5B"),p=t("PnTt"),m=(t("w9C0"),t("XW+2")),u=t("r0ML"),f=t.n(u),h=t("6eYn"),D=t("tHGw"),w=t.n(D),b=t("U32T"),I=t("ID3L"),g=t.n(I),v=t("RECs"),y=m.a.confirm,E={getRowSelection:function(e){return{getCheckboxProps:function(e){return{name:e.name,disabled:"\u5de5\u7a0b\u53ef\u884c\u6027\u7814\u7a76\u62a5\u544a"===e.complianceBanseName||"\u5de5\u53ef\u6279\u590d\u6216\u9879\u76ee\u6838\u51c6"===e.complianceBanseName||"\u521d\u8bbe\u6279\u590d"===e.complianceBanseName||"\u65bd\u5de5\u56fe\u8bbe\u8ba1\u6279\u590d"===e.complianceBanseName||"\u7528\u5730\u6279\u590d"===e.complianceBanseName||"\u65bd\u5de5\u8bb8\u53ef\u8bc1"===e.complianceBanseName||"\u878d\u8d44\u534f\u8bae"===e.complianceBanseName||"\u73af\u8bc4\u6279\u590d"===e.complianceBanseName}}}},antd:{rowKey:function(e){return e.complianceDetailId},size:"small"},drawerConfig:{width:"1000px"},curPage:1,limit:999999,paginationConfig:!1,formItemLayout:{labelCol:{xs:{span:21},sm:{span:3}},wrapperCol:{xs:{span:21},sm:{span:21}}},firstRowIsSearch:!1,isShowRowSelect:!0},k=function(e){function a(e){var t;return Object(c.a)(this,a),(t=Object(d.a)(this,Object(s.a)(a).call(this,e))).refresh=function(){t.setState({loading:!0},function(){var e=t.state,a=e.complianceDealId,n=e.projectId;t.props.myFetch("getZjTzComplianceDetailList",{complianceDealId:a}).then(function(e){var a=e.data,i=e.success,l=e.message;i?a.length?(a[0].projectId=n,t.setState({rowData:a[0],data:a[0].zjTzComplianceDetailList,loading:!1})):t.setState({data:[],loading:!1}):o.b.error(l)})})},t.state={complianceDealId:e.match.params.complianceDealId||"",projectId:e.match.params.projectId||"",data:[],loading:!1,rowData:{},index:0},t}return Object(p.a)(a,e),Object(r.a)(a,[{key:"componentDidMount",value:function(){this.refresh()}},{key:"render",value:function(){var e=this,a=this.state,c=a.data,r=a.loading,d=a.rowData;return f.a.createElement("div",{className:w.a.root},f.a.createElement(n.a,{spinning:r},f.a.createElement("div",{className:w.a.top},f.a.createElement("div",{className:w.a.topl},f.a.createElement("h4",{style:{color:"red"}},"\u5e94\u529e\u7406\u73af\u8282\u6307\u7684\u662f\u9879\u76ee\u516c\u53f8\u6210\u7acb\u65f6\uff0c\u9879\u76ee\u5e94\u529e\u7406\u7684\u5408\u6cd5\u5408\u89c4\u6587\u4ef6\uff0c\u4ece\u5de5\u53ef\u3001\u521d\u8bbe\u3001\u65bd\u8bbe\u3001\u7528\u5730\u3001\u65bd\u5de5\u8bb8\u53ef\u3001\u878d\u8d44\u534f\u8bae\u4e2d\u9009\u62e9")),f.a.createElement("div",{className:w.a.topr},(null===d||void 0===d?void 0:d.companyName)?f.a.createElement("div",null,f.a.createElement("span",{style:{fontWeight:"bold"}},"\u7ba1\u7406\u5355\u4f4d\uff1a"),d.companyName):null,(null===d||void 0===d?void 0:d.projectShortName)?f.a.createElement("div",null,f.a.createElement("span",{style:{fontWeight:"bold"}},"\u5f53\u524d\u9879\u76ee\uff1a"),d.projectShortName):null,(null===d||void 0===d?void 0:d.subprojectName)?f.a.createElement("div",null,f.a.createElement("span",{style:{fontWeight:"bold"}},"\u5b50\u9879\u76ee\u540d\u79f0\uff1a"),d.subprojectName):null)),f.a.createElement(h.a,Object(i.a)({},this.props,{fetch:this.props.myFetch,upload:this.props.myUpload,headers:{token:this.props.loginAndLogoutInfo.loginInfo.token},wrappedComponentRef:function(a){e.table=a},data:c},E,{formConfig:[{isInTable:!1,form:{field:"complianceDetailId",type:"string",hide:!0}},{table:{title:"\u5236\u5ea6\u65f6\u9650\u9884\u8b66",dataIndex:"colourFlag",key:"colourFlag",width:100,render:function(e,a,n){return n<8?"green"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("sgKX")})):"yellow"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("xHv8")})):"red"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("y8v7")})):"":""}},form:{type:"string",placeholder:"\u8bf7\u8f93\u5165"}},{table:{title:"\u7b56\u5212\u65f6\u9650\u9884\u8b66",dataIndex:"colourFlag1",key:"colourFlag1",width:100,render:function(e,a,n){return n<8?"green"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("sgKX")})):"yellow"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("xHv8")})):"red"===e?f.a.createElement("div",null,f.a.createElement(l.a,{shape:"square",size:20,src:t("y8v7")})):"":""}},form:{type:"string",placeholder:"\u8bf7\u8f93\u5165"}},{table:{title:"\u5e8f\u53f7",dataIndex:"index",key:"index",width:50,render:function(e,a,t){return t+1}},isInForm:!1},{table:{title:"\u73af\u8282\u7f16\u53f7",dataIndex:"num",key:"num",width:100},form:{type:"string",placeholder:"\u8bf7\u8f93\u5165"}},{table:{title:"\u5408\u89c4\u73af\u8282\u540d\u79f0",dataIndex:"complianceBanseName",key:"complianceBanseName",width:120,tdEdit:!0,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.complianceBanseName=a.newRowData.complianceBanseName),e})}},form:{type:"string",placeholder:"\u8bf7\u8f93\u5165",disabled:function(e,a){return e.rowIndex<8}}},{table:{title:"<center>\u9879\u76ee\u516c\u53f8\u6210\u7acb\u65f6<br/>\u5e94\u529e\u7406\u73af\u8282</center>",dataIndex:"dealFlag",key:"dealFlag",width:120,tdEdit:!0,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId?e.dealFlag="1":e.dealFlag="0",e}),e.table.refresh()},render:function(){return""}},form:{type:"radio",optionData:[{label:"",value:"1"}],initialValue:"0",disabled:function(e,a){return e.rowIndex>7}}},{table:{title:"<center>\u5236\u5ea6\u8981\u6c42\u5e94\u529e\u7406<br>\u5b8c\u7ed3\u7684\u65e5\u671f<center>",dataIndex:"shouldFinishDate",key:"shouldFinishDate",format:"YYYY-MM-DD",tdEdit:!0,width:100,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.shouldFinishDate=a.newRowData.shouldFinishDate),e})}},form:{type:"date",placeholder:"\u8bf7\u9009\u62e9",disabled:function(e,a){return e.rowIndex<8}}},{table:{title:"<center>\u7b56\u5212\u6279\u590d\u5e94\u529e\u7406<br>\u5b8c\u7ed3\u65e5\u671f<center>",dataIndex:"approvalShouldFinishDate",key:"approvalShouldFinishDate",format:"YYYY-MM-DD",tdEdit:!0,width:100,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.approvalShouldFinishDate=a.newRowData.approvalShouldFinishDate),e})}},form:{type:"date",placeholder:"\u8bf7\u9009\u62e9"}},{table:{title:"\u6587\u4ef6\u6279\u590d\u65e5\u671f",dataIndex:"approvalDate",key:"approvalDate",format:"YYYY-MM-DD",tdEdit:!0,width:100,tdEditCb:function(a){a.newRowData.approvalDate<g()().startOf("day").valueOf()?(o.b.error("\u6587\u4ef6\u6279\u590d\u65e5\u671f\u4e0d\u53ef\u9009\u62e9\u5c0f\u4e8e\u4eca\u5929\u7684\u65e5\u671f\uff01"),e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.approvalDate=void 0),e}),e.table.refresh()):e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.approvalDate=a.newRowData.approvalDate),e})}},form:{type:"date",placeholder:"\u8bf7\u9009\u62e9"}},{table:{title:"\u529e\u7406\u60c5\u51b5",dataIndex:"dealSituation",key:"dealSituation",tdEdit:!0,width:100,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.dealSituation=a.newRowData.dealSituation),e})}},form:{type:"select",optionConfig:{label:"label",value:"value"},optionData:[{label:"\u672a\u542f\u52a8",value:"0"},{label:"\u529e\u7406\u4e2d",value:"1"},{label:"\u5df2\u5b8c\u6210",value:"2"},{label:"\u65e0\u9700\u529e\u7406",value:"3"}],placeholder:"\u8bf7\u9009\u62e9"}},{table:{title:"\u9644\u4ef6",dataIndex:"zjTzFileList",key:"zjTzFileList",tdEdit:!0,width:120,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.zjTzFileList=a.newRowData.zjTzFileList),e})}},form:{type:"files",fetchConfig:{apiName:window.configs.domain+"upload"},showDownloadIcon:!0,onPreview:"bind:_docFilesByOfficeUrl"}},{table:{title:"\u5907\u6ce8",dataIndex:"bz",key:"bz",width:150,tdEdit:!0,tdEditCb:function(a){e.state.data.map(function(e){return e.complianceDetailId===a.newRowData.complianceDetailId&&(e.bz=a.newRowData.bz),e})}},form:{type:"string",placeholder:"\u8bf7\u8f93\u5165"}},{isInForm:!1,table:{title:"\u64cd\u4f5c",fixed:"right",dataIndex:"action",key:"action",align:"center",noHaveSearchInput:!0,showType:"tile",width:80,btns:[{name:"ComplianceToDealWithDetail",render:function(e,a,t){return t<8?"":"<a>\u63d2\u5165</a>"},onClick:function(a){e.setState({loading:!0,index:e.state.index+1},function(){for(var t=e.state.data,n=0,i=0;i<t.length;i++)t[i].complianceDetailId===a.rowData.complianceDetailId&&(n=i);t.splice(n,0,{complianceDealId:e.state.rowData.complianceDealId,complianceDetailId:String(e.state.index)});for(var l=[],o=0;o<t.length;o++)t[o].num=o<=8?"00".concat(o+1):"0".concat(o+1),l.push(t[o]);e.setState({data:l,loading:!1})})}}]}}],method:{goBack:function(a){e.props.dispatch(Object(b.c)())},saveClick:function(a){e.setState({loading:!0},function(){for(var t=0;t<e.state.data.length;t++){if("1"===e.state.data[t].dealFlag){for(var n=0;n<e.state.data.length;n++){if("2"===e.state.data[n].dealSituation&&!e.state.data[n].approvalDate){o.b.error("\u529e\u7406\u60c5\u51b5\u4e3a\u3010\u5df2\u5b8c\u6210\u3011\u7684\u6570\u636e\u6587\u4ef6\u6279\u590d\u65e5\u671f\u5fc5\u586b\uff01",5),e.setState({loading:!1});break}if("3"===e.state.data[n].dealSituation&&!e.state.data[n].bz){o.b.error("\u529e\u7406\u60c5\u51b5\u4e3a\u3010\u65e0\u9700\u529e\u7406\u3011\u7684\u6570\u636e\u5907\u6ce8\u5fc5\u586b\uff01",5),e.setState({loading:!1});break}n===e.state.data.length-1&&y({content:"\u786e\u5b9a\u4fdd\u5b58\u6570\u636e\u5417?",onOk:function(){d.zjTzComplianceDetailList=e.state.data,a.btnCallbackFn.fetchByCb("saveZjTzComplianceDealAllDetail",d,function(a){a.data;var t=a.success,n=a.message;t?(o.b.success(n),e.setState({loading:!1}),e.refresh()):(o.b.error(n),e.setState({loading:!1}),e.refresh())})}})}break}t===e.state.data.length-1&&(o.b.error("\u9879\u76ee\u516c\u53f8\u6210\u7acb\u65f6\u5e94\u529e\u7406\u73af\u8282\u5fc5\u987b\u52fe\u9009\u4e00\u6761\uff01",5),e.setState({loading:!1}))}})},diydelClick:function(a){e.setState({loading:!0},function(){var t=a.selectedRows,n=e.state.data;n=n.filter(function(e){return!t.map(function(e){return e.complianceDetailId}).includes(e.complianceDetailId)});for(var i=[],l=0;l<n.length;l++)n[l].num=l<=8?"00".concat(l+1):"0".concat(l+1),i.push(n[l]);e.setState({data:i,loading:!1},function(){e.table.clearSelectedRows()})})},exportClick:function(){var a=e.props,t=a.loginAndLogoutInfo.loginInfo.token,n=a.myPublic.domain,i={fileName:"".concat(null===d||void 0===d?void 0:d.projectShortName,"\u5408\u6cd5\u5408\u89c4\u529e\u7406\u60c5\u51b5"),complianceDealId:null===d||void 0===d?void 0:d.complianceDealId},l="".concat(n+"exportZjTzComplianceDetailList");y({content:"\u786e\u5b9a\u5bfc\u51fa\u6570\u636e\u5417?",onOk:function(){Object(v.a)(l,i,{token:t})}})}},actionBtns:{apiName:"getSysMenuBtn",otherParams:function(e){var a=e.Pprops;return{menuParentId:a.routerInfo.routeData[a.routerInfo.curKey]._value,tableField:"projectInfo"}}}}))))}}]),a}(u.Component);a.default=k}}]);