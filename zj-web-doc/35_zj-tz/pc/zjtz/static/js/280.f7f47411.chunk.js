(window.webpackJsonp=window.webpackJsonp||[]).push([[280],{"8Iac":function(e,t,n){"use strict";n.r(t);var a=n("bqt4"),o=n.n(a),r=n("+n0K"),i=(n("3fBH"),n("g2mn")),d=n("r0ML"),c=n.n(d),l=(n("C/2i"),n("ID3L"),n("+K9n"),n("0DJy"),n("tpuf"),n("fx2i"),n("40Q9"),n("VpwF"),n("9M8h"),n("w9C0"),n("XW+2")),f=(n("HJbo"),n("daJc"),n("Sw1S"),n("07Zm"),n("739E"),n("j0L1"),n("5fiz"),c.a.lazy(function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(4),n.e(6),n.e(5),n.e(8),n.e(9),n.e(10),n.e(11),n.e(12),n.e(13),n.e(14),n.e(15)]).then(n.bind(null,"+Wf6"))}));t.default=function(e){var t,n=e.incToForm,a=e.addRowDataAddress,d=void 0===a?"after":a,u=e.tableTdEdit,s=e.wrappedComponentRef,m=e.value,b=void 0===m?[]:m,p=e.actionBtns,v=void 0===p?[]:p,w=e.onChange,h=e.formConfig,C=void 0===h?[]:h,g=e.fetchConfig,F=void 0===g?{}:g,R=e.funcCallBackParams,j=Object(r.s)(e,["incToForm","addRowDataAddress","tableTdEdit","wrappedComponentRef","value","actionBtns","onChange","formConfig","fetchConfig","funcCallBackParams"]),O=c.a.useRef(),T=c.a.useState(!1),E=Object(r.p)(T,2),D=E[0],y=E[1],B=e.qnnFormProps.fns,k=B.setEditRowId,q=B.getEditRowId,P=B.getFetchedTablesField,S=B.addFetchedTablesField,I=B.bind,_=e.qnnFormProps.qnnformData,x=_.loadingByForm,J=_.method,K="incToform_formBlock_".concat(e.filed),N={fetchConfig:F};x&&(N={fetchConfig:{}});var A,H,L=(H=Object(r.t)(o.a.mark(function t(){var n,a,i,d,c,l,f,u,s,m,b,p;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=F.apiName,i=F.params,d=void 0===i?{}:i,c=F.otherParams,l=void 0===c?{}:c,f=e.qnnFormProps,u=f.qnnFormProps,s=void 0===u?{}:u,m=f.qnnformData.match,b=void 0===m?{}:m,t.next=4,r.b.getFetchParams({params:d,otherParams:l,match:b,form:e.form||{},bind:I,funcCallBackParams:R,rowData:(null==s?void 0:null===(n=s.clickCb)||void 0===n?void 0:n.rowData)||{}});case 4:return p=t.sent,t.abrupt("return",{params:p,apiName:a});case 6:case"end":return t.stop()}},t)})),function(){return H.apply(this,arguments)}),z=(A=Object(r.t)(o.a.mark(function t(){var n,a,i,d,c,l,f,u;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return y(!0),t.next=3,L();case 3:return n=t.sent,a=n.apiName,i=n.params,t.next=8,e.fetch(a,i);case 8:d=t.sent,c=d.success,l=d.data,f=d.message,u=d.code,y(!1),S(K),c?w(l):"-1"===u?r.b.msg.error(f):r.b.msg.warn(f);case 16:case"end":return t.stop()}},t)})),function(){return A.apply(this,arguments)});if(c.a.useEffect(function(){O.current=!0,O.current&&n&&F.apiName&&!P(K)&&z(),O.current=!1,q()&&n&&t.qnnSetState({editRowId:q()})},[]),n){var M,V;if(!Array.isArray(v))return console.error("actionBtns\u4e0d\u53ef\u914d\u7f6e\u4e3a \u975e\u6570\u7ec4 \u7c7b\u578b");if("string"!=typeof(null===(M=j.antd)||void 0===M?void 0:M.rowKey))return console.error("incToForm \u8868\u683cantd.rowKey\u4e3a\u5fc5\u987b\u914d\u7f6e\u5e76\u4e14\u5fc5\u987b\u4e3astring\u7c7b\u578b");var W=null===(V=j.antd)||void 0===V?void 0:V.rowKey,G=function(){var t=e.form||e.qnnFormProps.form;return(t?t.getFieldValue(j.field):b)||[]};return c.a.createElement("div",{id:K},c.a.createElement(i.a,{spinning:D,tip:"loading..."},c.a.createElement(f,Object(r.q)({data:b,tableTdEdit:u,tableFieldByIncToFormGetFetchConfig:L,actionBtns:v.map(function(e){var t=e.name;return"addRow"===t?Object(r.l)({},e,{addCb:"bind:_addRowToFormData"}):"del"===t?Object(r.l)({},e,{onClick:"bind:_delRowToFormData"}):Object(r.l)({},e)}),formConfig:C.map(function(e){var t;return(null==e?void 0:null===(t=e.table)||void 0===t?void 0:t.tdEdit)?Object(r.l)({},e,{table:Object(r.l)({},e.table,{tdEditCb:"bind:_tdEditCbToFormData"})}):Object(r.l)({},e)})},j,{wrappedComponentRef:function(e){e&&(t=e,s&&s(e))},method:Object(r.l)({_addRowToFormData:function(n){var a,o=G();if(t.state.editRowId)l.a.error({title:"\u5728\u505a\u9009\u62e9\u64cd\u4f5c\u4e4b\u524d\u8bf7\u5148\u4fdd\u5b58\u884c\u6570\u636e",content:c.a.createElement("div",null," \u8bf7\u70b9\u51fb\u8868\u683c\u53f3\u4fa7\u3010\u4fdd\u5b58\u6309\u94ae\u3011\u8fdb\u884c\u4fdd\u5b58 "),onOk:function(){}});else{var i=n.newRowData,f=(new Date).getTime()+"_"+o.length,s=Object(r.l)(Object(r.f)({},W,f),i);if(u&&(t.qnnSetState({editRowId:f}),k(f,"add")),"before"===d)w([s].concat(o));else if("after"===d){w(o.concat([s]));var m=document.getElementById(K);if(m){var b=m.getElementsByClassName("ant-table-body")[0];b&&b.scrollTo(0,b.scrollHeight+120)}}var p=null===(a=v.filter(function(e){return"addRow"===e.name})[0])||void 0===a?void 0:a.addCb;p&&I(p)(Object(r.l)({addRowData:s},e))}},_delRowToFormData:function(e){var t,n=e.selectedRows,a=e.btnCallbackFn,o=n.map(function(e){return e[W]});w(function e(t){return t.filter(function(t){return t.children&&(t.children=e(t.children)),!o.includes(t[W])})}(G())),a.setState({selectedRows:[]});var i=null===(t=v.filter(function(e){return"del"===e.name})[0])||void 0===t?void 0:t.onClick;i&&I(i)(Object(r.l)({},e))},_tdEditCbToFormData:function(e){var n=G(),a=e.newRowData,o=e.editField,i=e.oldTableDataByEditRow,d=function(){var e=function e(n){return n.map(function(n){return n[W]===a[W]?(u&&k(a[W]),u&&t.qnnSetState({editRowId:a[W]}),Object(r.l)({},n,{},a,Object(r.f)({},o,a[o]||0===a[o]||!1===a[o]?a[o]:void 0))):n.children?Object(r.l)({},n,{children:e(n.children)}):n})}(i||n);w(e)};e.tableTdEditSaveBtn?d():setTimeout(d)}},J,{},j.method)}))))}return c.a.createElement(f,Object(r.q)({},e,N,{method:Object(r.l)({},J,{},j.method),wrappedComponentRef:function(e){s&&s(e),t=e}}))}}}]);