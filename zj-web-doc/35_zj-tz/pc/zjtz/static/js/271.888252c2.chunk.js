(window.webpackJsonp=window.webpackJsonp||[]).push([[271],{"Rlh+":function(e,t,a){"use strict";a.r(t);var n=a("Id3l"),r=a("RNsw"),l=a("OR/T"),o=a("bn5B"),i=a("PnTt"),s=a("r0ML"),c=a.n(s),d=a("fbSu"),u=a.n(d),h=a("5T12"),p=a.n(h),f=a("qHWA"),m=a.n(f),v=a("rx6U"),g=a.n(v),y=a("4tJN"),S=a.n(y),b=a("Qsbb"),D=a.n(b),E=(a("9U97"),a("+kFb"),a("x/6R"),a("Z5ek"),a("jnfO"),a("zIPO"),a("MRnW"),a("IdsT"),a("GzNv"),a("l9AF"),a("+xeR"),a("Id6h"),a("orcL"),a("07Zm"),a("2HLw")),I=a("Wv3C"),K=a.n(I),k=(a("Rdx9"),a("Le+4")),R=(a("K4KN"),a("lOXM")),w=(a("NExk"),a("ftLu")),x=a("eRGJ"),C=a.n(x),L=a("eKXt"),T=a.n(L),V=a("EByn"),P=a.n(V),F=a("qQuN"),U=a.n(F),M=(a("fx2i"),a("cZi0")),A=a("isxb"),N=a.n(A),O=a("wJ7t"),j=a.n(O),B=a("rD0L"),_=a.n(B),J=a("bj0d"),z=a.n(J),W=a("i2ZC"),H=a.n(W),Y=(a("PzPB"),a("aSHn")),Z=(a("w9C0"),a("XW+2")),X=(a("p3n1"),a("3Dc/")),q=a("fIjf"),G=(a("bSDv"),a("+K9n")),Q=a("U32T");function $(e,t){var a=D()(e);if(S.a){var n=S()(e);t&&(n=n.filter(function(t){return g()(e,t).enumerable})),a.push.apply(a,n)}return a}function ee(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$(Object(a),!0).forEach(function(t){U()(e,t,a[t])}):m.a?p()(e,m()(a)):$(Object(a)).forEach(function(t){u()(e,t,g()(a,t))})}return e}var te=window.configs.language,ae=void 0===te?"zh_CN":te,ne="en_US"===ae,re={Rename:"en_US"===ae?"Rename":"\u91cd\u547d\u540d",confirm:"en_US"===ae?"confirm":"\u786e\u8ba4",cancel:"en_US"===ae?"cancel":"\u53d6\u6d88",delete:"en_US"===ae?"delete":"\u5220\u9664",save:"en_US"===ae?"save":"\u4fdd\u5b58",placeholder:"en_US"===ae?"please enter...":"\u8bf7\u8f93\u5165..."},le=X.a.TabPane,oe=q.a.Item,ie=Z.a.confirm,se=Y.a.TreeNode,ce=function(e){function t(){var e,a;N()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=_()(this,(e=z()(t)).call.apply(e,[this].concat(r)))).depId=a.props.match.params.depId||"0",a.gData=[],a.pData=[],a.tData=[],a.modals={},a.visibleValue="",a.endKey=a.depId,a.inputValue="",a.state={record:{},mData:[],nData:[],gData:[],pData:[],rState:"0",selectedRowKeys:[],treeSelectedKeys:[],expandedKeys:[],visibleValue:"",editValue:"",visible:!1},a.loadTree=function(){var e,t=a.props,n=t.myFetch,r=t.loginAndLogoutInfo,l=void 0===r?{}:r;M.b.loading("loading...",0);var o={};if(null===l||void 0===l?void 0:null===(e=l.loginInfo)||void 0===e?void 0:e.userInfo){var i=l.loginInfo.userInfo.curCompany,s=void 0===i?{}:i;s.value&&(o.departmentId=s.value)}n("getSysRoleAllTree",ee({},o)).then(function(e){var t=e.success,n=e.data;if(M.b.destroy(),t){a.gData=[n],a.endKey="0"===a.depId?n.value:a.depId;var r=a.initSimpleData(a.gData),l=a.getBreadcrumb(a.endKey,r).keys;a.loadList().then(function(e){a.setState({rState:"0",loading:!1,mData:e,selectedRowKeys:[],tData:P()(a.tData),pData:P()(a.pData),gData:P()(a.gData),expandedKeys:l,treeSelectedKeys:[a.endKey]})})}})},a.setSelectedRowKeys=function(e){a.setState({selectedRowKeys:e})},a.loadList=function(){var e=a.props.myFetch;a.setState({loading:!0});var t={roleId:a.endKey};return new T.a(function(a){e("getSysRoleUserList",t).then(function(e){var t=e.success,n=e.data;t&&a(n)})})},a.loadList2=function(){var e=a.props.myFetch;a.setState({loading:!0});var t={roleId:a.endKey};return new T.a(function(a){e("getSysRoleMenuListByRole",t).then(function(e){var t=e.success,n=e.data;t&&a(n)})})},a.initSimpleData=function(e){var t={};return function e(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(a){var n=a.value,r=a.children,l=void 0===r?[]:r;t[n]=a,l.length&&e(l)})}(e),t},a.getLoopMatch=function(e,t,n){e.forEach(function(e,r,l){return e.value===t?n(e,r,l):e.children?a.getLoopMatch(e.children,t,n):void 0})},a.getBreadcrumb=function(e,t){for(var a=[],n=[];e;)if(t[e]){var r=t[e].valuePid;a.unshift(e),n.unshift(t[e]),e=r}else e=null;return{keys:a,datas:n}},a.onSelect=function(e,t){var n=t.node,r=a.props,l=r.dispatch,o=r.routerInfo,i=o.curKey,s=o.routeData[i].moduleName;a.visibleValue===n.props.eventKey||a.state.editValue||(a.visibleValue="",a.endKey=n.props.eventKey,l(Object(Q.f)("".concat(s,"roles/").concat(a.endKey))),a.loadList().then(function(t){a.setState({selectedRowKeys:[],treeSelectedKeys:e,mData:t,rState:"0",loading:!1})}))},a.onExpand=function(e){a.setState({expandedKeys:e})},a.onDragEnter=function(e){a.setState({expandedKeys:e.expandedKeys})},a.onRightClick=function(e){a.setState({visibleValue:e.node.props.eventKey})},a.handle=function(e){"0"===e.rState?a.loadList().then(function(e){a.setState({rState:"0",loading:!1,mData:e,selectedRowKeys:[]})}):"1"===e.rState&&a.loadList2().then(function(e){a.setState({rState:"1",loading:!1,nData:e,selectedRowKeys:[]})}),a.setState(e)},a}return H()(t,e),j()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.myFetch;M.b.loading("loading...",0),t("getSysMenuAllTree").then(function(t){var a=t.success,n=t.data;M.b.destroy(),a&&(e.tData=C()(n)?n:[n],e.loadTree())})}},{key:"render",value:function(){var e=this,t=this.props.myFetch,a=this.state,n=a.rState,r=a.tData,l=a.gData,o=a.mData,i=a.nData,s=(a.pData,a.expandedKeys),d=a.treeSelectedKeys,u=a.visibleValue,h=a.editValue;return c.a.createElement(k.a,{style:{background:"transparent"},onClick:function(t){return u&&e.setState({visibleValue:""}),!1}},c.a.createElement(k.a.Sider,{style:{background:"transparent",borderRight:"1px solid #f0f2f5",marginRight:"16px"}},c.a.createElement(Y.a,{draggable:!1,disabled:!!h,onExpand:this.onExpand,onSelect:this.onSelect,expandedKeys:s,selectedKeys:d,onDragEnter:this.onDragEnter,onDrop:this.onDrop,onRightClick:this.onRightClick},function a(n){return n.map(function(n){var r=n.children,l=void 0===r?[]:r,o=n.value,i=n.type,s=n.valuePid,d=ne&&n.labelUS||n.label,p=function(a){var n;switch(e.visibleValue=o,a){case 0:t("syncWeChatToSysInfo",n).then(function(t){var a=t.success,n=t.message;a||M.b.error(n,1.2,function(){e.loadTree()})});break;case 1:var r=[].concat([o],e.state.expandedKeys),l=Math.random(),i={value:l,label:"",type:"1",valuePid:o,children:[],isAdd:!0};e.getLoopMatch(e.gData,o,function(e,t,a){e.children=e.children||[],e.children.push(i)}),e.inputValue="",e.setState({gData:P()(e.gData),editValue:l,expandedKeys:r});break;case 2:e.inputValue=d,e.setState({editValue:o});break;case 3:e.getLoopMatch(e.gData,o,function(e,t,a){a.splice(t,1)}),e.setState({gData:P()(e.gData)}),t("batchDeleteUpdateSysRole",n=[{roleId:o}]).then(function(t){var a=t.success,n=t.message;a||M.b.error(n,1.2,function(){e.loadTree()})})}},f=c.a.createElement("div",null,"0"===s?c.a.createElement("div",null,c.a.createElement("a",{onClick:function(){return p(1)}},ne?"Creating Roles":"\u65b0\u5efa\u89d2\u8272")):null,"0"!==s?c.a.createElement("div",null,c.a.createElement("a",{onClick:function(){return p(2)}},re.Rename)):null,"0"!==s?c.a.createElement("div",null,c.a.createElement("a",{onClick:function(){ie({title:ne?"Are you sure you want to delete the role \u3010".concat(d,"\u3011?"):"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u89d2\u8272\u3010".concat(d,"\u3011\u4e48?"),content:"",okText:re.confirm,cancelText:re.cancel,onOk:function(){return p(3)}})}},re.delete)):null),m=function(a){var n=a.data,r=n.valuePid,l=n.value,o=n.isAdd,i=void 0!==o&&o,s=a.data,d=a.visible,u=a.edit,h=ne&&s.labelUS||s.label,p=function(a){var n=a.target.value.toString().trim();if(n)if(i){var o,s,c={roleParentId:r,roleFlag:1};if(null===(o=e.props.loginAndLogoutInfo)||void 0===o?void 0:null===(s=o.loginInfo)||void 0===s?void 0:s.userInfo){var d=e.props.loginAndLogoutInfo.loginInfo.userInfo.curCompany,u=void 0===d?{}:d;u.value&&(c.departmentId=u.value)}ne?c.roleNameUS=n:c.roleName=n,M.b.loading("loading..."),t("addSysRole",c).then(function(t){var a=t.success,n=t.message,r=t.data;if(M.b.destroy(),a){var o=r.roleId,i=r.roleName,s=r.roleNameUS,c=r.roleParentId,d=r.children,u=void 0===d?[]:d;e.getLoopMatch(e.gData,l,function(e,t,a){ne?e.labelUS=s:e.label=i,e.value=o,e.valuePid=c,e.children=u,e.isAdd=!1}),e.setState({gData:P()(e.gData),editValue:""})}else M.b.error(n,1.2,function(){e.loadTree()})})}else{e.getLoopMatch(e.gData,l,function(e,t,a){e.label=n});var h={roleId:l};ne?h.roleNameUS=n:h.roleName=n,t("updateSysRole",h).then(function(t){var a=t.success,n=t.message;a||M.b.error(n,1.2,function(){e.loadTree()})}),e.setState({gData:P()(e.gData),editValue:""})}else i&&e.getLoopMatch(e.gData,l,function(e,t,a){a.splice(t,1)}),e.setState({gData:P()(e.gData),editValue:""})};return u?c.a.createElement(w.a,{autoFocus:!0,defaultValue:e.inputValue,placeholder:ne?"Please enter the department name":"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d\u79f0",onBlur:p,onPressEnter:p}):c.a.createElement(R.a,{visible:d,placement:"rightTop",content:f},h)};return l.length?c.a.createElement(se,{key:o,title:c.a.createElement(m,{data:n,edit:h===o,visible:u===o})},a(l)):"2"!==i?c.a.createElement(se,{key:o,title:c.a.createElement(m,{data:n,edit:h===o,visible:u===o})}):null})}(l))),c.a.createElement(k.a.Content,null,function(){var t,a=[{label:"roleId",type:"hidden",dataIndex:"roleId"},{label:ne?"personnel selection":"\u4eba\u5458\u9009\u62e9",dataIndex:"sysRoleUserList",type:"PullPersion"}],l=[{label:"roleId",type:"hidden",dataIndex:"roleId"},{label:ne?"menu selection":"\u83dc\u5355\u9009\u62e9",dataIndex:"sysRoleMenuList",type:"Menu",treeData:r}];switch(n){case"1":t=c.a.createElement(pe,K()({},e.props,{handle:e.handle,columns:l,dataSource:{sysRoleMenuList:i,roleId:e.endKey}}));break;case"0":default:t=c.a.createElement(ue,K()({},e.props,{handle:e.handle,columns:a,dataSource:{sysRoleUserList:o,roleId:e.endKey}}))}return t}()))}}]),t}(s.Component),de=function(e){function t(){var e,a;N()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=_()(this,(e=z()(t)).call.apply(e,[this].concat(r)))).state={changeed:!1,rState:"0",loading:!1},a.handleSubmit=function(e){var t=a.props,n=t.form,r=t.myFetch;return n.validateFieldsAndScroll(function(e,t){if(!e){var n=ee({},t);M.b.loading("loading...",0),a.setState({loading:!0}),r("updateSysRoleUser",n).then(function(e){var t=e.success,n=e.message;M.b.destroy(),t?(a.setState({changeed:!1}),M.b.success(n,1.2,function(){a.handle({rState:"1"}),a.setState({rState:"1",loading:!1})})):(a.setState({loading:!1}),M.b.error(n,1.2))})}}),e&&e.preventDefault&&e.preventDefault(),!1},a.handle=function(e){a.state.changeed?Z.a.warning({title:ne?"You have not saved the data":"\u60a8\u8fd8\u6ca1\u6709\u4fdd\u5b58\u6570\u636e",content:ne?'Click the "save personnel modify" button below to save the data in the switch bar!':"\u70b9\u51fb\u4e0b\u9762\u3010\u4fdd\u5b58\u4eba\u5458\u4fee\u6539\u3011\u6309\u94ae\u4fdd\u5b58\u6570\u636e\u540e\u5728\u5207\u6362\u5427\uff01"}):(a.props.handle(e),a.setState(e))},a}return H()(t,e),j()(t,[{key:"render",value:function(){var e=this,t={labelCol:{span:2},wrapperCol:{span:12}},a=this.props,n=a.form.getFieldDecorator,r=a.columns,l=a.dataSource,o=a.myFetch,i=a.loginAndLogoutInfo.loginInfo.userInfo.curCompany,s=(void 0===i?{}:i).departmentId,d=r.map(function(a,r){var i,d=a.dataIndex,u=a.label;switch(a.type){case"PullPersion":i=c.a.createElement(oe,K()({key:r},t),n(d,{valuePropName:"defaultValue",initialValue:l[d]||[],onChange:function(t){e.setState({changeed:!0})}})(c.a.createElement(G.default,{search:!0,help:!0,searchApi:"getSysUserCurrentTree",searchParamsKey:"search",searchOtherParams:s?{departmentParentId:s}:{},myFetch:o,edit:!0,fetchConfig:{apiName:"getSysUserCurrentTree",paramsKey:"departmentParentId",params:{topId:s}}})));break;case"hidden":n(d,{initialValue:l[d]||""});break;default:i=c.a.createElement(oe,K()({key:r,label:u},t,{hasFeedback:!0}),n(d,{initialValue:l[d]||""})(c.a.createElement(w.a,{placeholder:u})))}return i});return c.a.createElement(q.a,{onSubmit:this.handleSubmit},c.a.createElement(X.a,{activeKey:this.state.rState,defaultActiveKey:"0",onChange:function(t){e.handle({rState:t})}},c.a.createElement(le,{tab:ne?"personnel selection":"\u4eba\u5458\u9009\u62e9",key:"0"}),c.a.createElement(le,{tab:ne?"menu selection":"\u83dc\u5355\u9009\u62e9",key:"1"})),c.a.createElement("div",{style:{height:"65vh",overflowY:"scroll",marginBottom:"16px",boxSizing:"border-box",paddingLeft:3}},d),c.a.createElement(E.a,{htmlType:"submit",type:"primary",loading:this.state.loading},ne?"Saver modification":"\u4fdd\u5b58\u4eba\u5458\u4fee\u6539"))}}]),t}(s.Component),ue=q.a.create({mapPropsToFields:function(e){return{dataSource:q.a.createFormField(ee({},e.dataSource))}}})(de),he=function(e){function t(){var e,a;N()(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=_()(this,(e=z()(t)).call.apply(e,[this].concat(r)))).state={selectedKeys:[],changeed:!1,rState:"1",loading:!1},a.handleSubmit=function(e){var t=a.props,n=t.form,r=t.myFetch;return n.validateFieldsAndScroll(function(e,t){if(!e){var n=ee({},t,{sysRoleMenuList:t.sysRoleMenuList.map(function(e){return{value:e}})});M.b.loading("loading...",0),a.setState({loading:!0}),r("updateSysRoleMenu",n).then(function(e){var t=e.success,n=e.message;M.b.destroy(),a.setState({loading:!1}),t?(a.setState({changeed:!1}),M.b.success(n,1.2,function(){a.handle({rState:"0"}),a.setState({rState:"0"})})):M.b.error(n,1.2)})}}),e&&e.preventDefault&&e.preventDefault(),!1},a.handle=function(e){a.state.changeed?Z.a.warning({title:ne?"You have not saved the data":"\u60a8\u8fd8\u6ca1\u6709\u4fdd\u5b58\u6570\u636e",content:ne?'Click the "save menu modify" button below to save the data in the switch bar!':"\u70b9\u51fb\u4e0b\u9762\u3010\u4fdd\u5b58\u83dc\u5355\u4fee\u6539\u3011\u6309\u94ae\u4fdd\u5b58\u6570\u636e\u540e\u5728\u5207\u6362\u5427\uff01"}):(a.props.handle(e),a.setState(ee({},e)))},a.onCheck=function(e){(0,a.props.form.setFieldsValue)({sysRoleMenuList:e}),a.setState({changeed:!0})},a.onSelect=function(e,t){a.setState({selectedKeys:e})},a.getTreeData=function(e){return e.map(function(e){var t={};try{t=e.title?JSON.parse(e.title):{}}catch(r){console.error("\u83dc\u5355\u6570\u636e\u89e3\u6790\u5931\u8d25\uff1a",e.title)}var n=e.label;return t.tableName&&(n="".concat(t.tableName,"-").concat(n)),ee({},e,{title:n,key:e.value,dataRef:e,children:a.getTreeData(e.children)})})},a}return H()(t,e),j()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.dataSource,r=t.columns.map(function(t,r){var l,o=t.dataIndex,i=t.type,s=t.treeData;switch(i){case"Menu":l=c.a.createElement(oe,{key:r},a(o,{valuePropName:"checkedKeys",initialValue:n[o].map(function(e){return e.value})||[]})(c.a.createElement(Y.a,{checkable:!0,defaultExpandAll:!0,onCheck:e.onCheck,onSelect:e.onSelect,selectedKeys:e.state.selectedKeys,treeData:e.getTreeData(s)})));break;case"hidden":a(o,{initialValue:n[o]||""})}return l});return c.a.createElement(q.a,{onSubmit:this.handleSubmit},c.a.createElement(X.a,{activeKey:this.state.rState,defaultActiveKey:"1",onChange:function(t){e.handle({rState:t})}},c.a.createElement(le,{tab:ne?"personnel selection":"\u4eba\u5458\u9009\u62e9",key:"0"}),c.a.createElement(le,{tab:ne?"menu selection":"\u83dc\u5355\u9009\u62e9",key:"1"})),c.a.createElement("div",{style:{maxHeight:"65vh",overflowY:"scroll",marginBottom:"16px",paddingLeft:3}},r),c.a.createElement(E.a,{htmlType:"submit",type:"primary",loading:this.state.loading},ne?"Save menu changes":"\u4fdd\u5b58\u83dc\u5355\u4fee\u6539"))}}]),t}(s.Component),pe=q.a.create({mapPropsToFields:function(e){return{dataSource:q.a.createFormField(ee({},e.dataSource))}}})(he),fe=ce,me=function(e){function t(){return Object(n.a)(this,t),Object(l.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(i.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return c.a.createElement(fe,this.props)}}]),t}(s.Component);t.default=me}}]);